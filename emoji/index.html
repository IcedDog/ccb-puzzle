<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’¬ğŸ§©ğŸ¯</title>
    <link rel="icon" href="../favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="../style.css">
    <style>
        button.btn,
        button.btn-secondary,
        button.btn-settings {
            background: var(--card-bg) !important;
            border: 2px solid var(--border-color) !important;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ğŸ’¬ğŸ§©ğŸ¯</h1>
            <p class="subtitle">ğŸ“›ğŸˆ¶ï¸ğŸ˜ƒğŸ’¬ğŸ¤–ï¼ŒğŸ¯ğŸ¤–ğŸ“£ğŸ¯ğŸ˜ƒï¼</p>
        </div>

        <div class="main-content">
            <div class="game-setup" id="gameSetup">
                <div class="setup-row">
                    <div class="setup-item">
                        <label for="initialChars">ğŸï¼š</label>
                        <input type="text" id="initialChars" placeholder="..." value="">
                    </div>
                    <div class="setup-item">
                        <label for="targetWord">ğŸ¯ï¼š</label>
                        <input type="text" id="targetWord" placeholder="..." value="">
                    </div>
                </div>
                <div class="setup-row">
                    <button class="btn" onclick="startGame()">ğŸ®</button>
                    <button class=" btn btn-settings right" onclick="openSettings()">âš™ï¸</button>
                    <button class="btn btn-theme" onclick="toggleTheme()">ğŸŒ—</button>
                </div>
            </div>

            <div class="game-area" id="gameArea">
                <div class="game-status" id="gameStatus">
                    <div class="target-badge">ğŸ¯ï¼š<span id="currentTarget"></span></div>
                </div>

                <div class="character-bank">
                    <h3>
                        ğŸ§± (<span id="charCount">0</span>)
                        <button class="character-bank-btn" onclick="copyBank()">ğŸ“‹</button>
                        <button class="character-bank-btn" onclick="pasteBank()">ğŸ“¥</button>
                    </h3>
                    <div class="character-grid" id="characterGrid"></div>
                </div>

                <div class="input-area">
                    <label for="userInput">ğŸ’¬ï¼š</label>
                    <div class="input-container">
                        <input type="text" id="userInput" placeholder="...">
                        <button class="btn" onclick="submitQuestion()" id="submitBtn">ğŸ“¨</button>
                        <button class="btn btn-secondary" onclick="clearInput()">ğŸ§¹</button>
                    </div>
                    <div class="input-warning" id="inputWarning">ğŸš«ğŸ’¬ğŸ˜ƒï¼ŒâŒï¼š</div>
                </div>

                <div class="chat-history">
                    <h3>
                        ğŸ§¾ (<span id="chatCount">0</span>)
                        <button class="character-bank-btn" onclick="exportChat()">âï¸</button>
                        <button class="refresh-btn right" onclick="refreshLatestChat()" title="ğŸ”„"></button>
                    </h3>
                    <div class="chat-container" id="chatContainer">
                        <div class="chat-placeholder">ğŸ’¬ğŸˆ¶ï¸ğŸ§¾...</div>
                    </div>
                </div>

                <div class="setup-row">
                    <button class="btn btn-secondary" onclick="resetGame()">ğŸ”</button>
                    <button class="btn btn-settings" onclick="openSettings()">âš™ï¸</button>
                </div>
            </div>
        </div>

        <div class="settings-modal" id="settingsModal">
            <div class="settings-content">
                <h2 style="margin-bottom: 20px;">âš™ï¸</h2>

                <div class="settings-item">
                    <div class="checkbox-item">
                        <input type="checkbox" id="disableEnglish" checked>
                        <label for="disableEnglish">ğŸš«ğŸ”¤</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="hardMode">
                        <label for="hardMode">ğŸ’€</label>
                    </div>
                </div>

                <div class="settings-item">
                    <div class="checkbox-item">
                        <input type="checkbox" id="useCustomApi" checked>
                        <label for="useCustomApi">ğŸ§°ğŸ”‘</label>
                    </div>
                </div>

                <div id="settings-api-item">
                    <div class="settings-item">
                        <label for="apiUrl">ğŸ”—ï¼š</label>
                        <input type="text" id="apiUrl" placeholder="https://api.siliconflow.cn/v1/chat/completions"
                            value="https://api.siliconflow.cn/v1/chat/completions">
                    </div>

                    <div class="settings-item">
                        <label for="apiKey">ğŸ”ï¼š</label>
                        <input type="password" id="apiKey" placeholder="sk-...">
                    </div>

                    <div class="guide">
                        <h4>âš¡ï¸ğŸ”</h4>
                        <ul>
                            <li>1ï¸âƒ£ ğŸ‘‰<a href="https://cloud.siliconflow.cn" target="_blank">ğŸ”—</a></li>
                            <li>2ï¸âƒ£ ğŸ‘¤âœ…</li>
                            <li>3ï¸âƒ£ ğŸ”‘â•</li>
                            <li>4ï¸âƒ£ ğŸ§ â¡ï¸ <code>deepseek-ai/DeepSeek-V3</code></li>
                            <li>5ï¸âƒ£ ğŸ’°ğŸ“¦</li>
                            <li>6ï¸âƒ£ âœï¸ğŸ”</li>
                        </ul>
                    </div>
                </div>

                <div class="settings-item">
                    <label for="modelName">ğŸ§ ï¼š</label>
                    <input type="text" id="modelName" placeholder="deepseek-ai/DeepSeek-V3"
                        value="deepseek-ai/DeepSeek-V3">
                </div>

                <div class="settings-item">
                    <label for="modelName">ğŸŒ¡ï¸ï¼š</label>
                    <div class="slider-item">
                        <input type="range" id="modelTemperature" min="0.1" max="1.0" step="0.1" value="0.7">
                        <div class="slider-value" id="modelTemperatureValue">0.7</div>
                    </div>
                </div>

                <div class="settings-item">
                    <label for="initPrompt">ğŸ’¡ï¼š</label>
                    <input type="text" id="initPrompt"
                        placeholder="è¯·ä½¿ç”¨è¡¨æƒ…ç¬¦å·å›åº”æ–¹æ‹¬å·ä¸­çš„å†…å®¹ã€‚å¦‚æœæ˜¯åè¯ï¼Œä½¿ç”¨è¡¨æƒ…ç¬¦å·ç»™å‡ºç®€è¦è§£é‡Šã€‚å¦‚æœæ˜¯æé—®ï¼Œä½¿ç”¨è¡¨æƒ…ç¬¦å·ç›´æ¥ç»™å‡ºå›ç­”ã€‚å¦‚æœæ˜¯å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨è¡¨æƒ…ç¬¦å·æ‰§è¡Œã€‚ä½ åªèƒ½ä½¿ç”¨è¡¨æƒ…ç¬¦å·ã€‚"
                        value="è¯·ä½¿ç”¨è¡¨æƒ…ç¬¦å·å›åº”æ–¹æ‹¬å·ä¸­çš„å†…å®¹ã€‚å¦‚æœæ˜¯åè¯ï¼Œä½¿ç”¨è¡¨æƒ…ç¬¦å·ç»™å‡ºç®€è¦è§£é‡Šã€‚å¦‚æœæ˜¯æé—®ï¼Œä½¿ç”¨è¡¨æƒ…ç¬¦å·ç›´æ¥ç»™å‡ºå›ç­”ã€‚å¦‚æœæ˜¯å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨è¡¨æƒ…ç¬¦å·æ‰§è¡Œã€‚ä½ åªèƒ½ä½¿ç”¨è¡¨æƒ…ç¬¦å·ã€‚" disabled>
                </div>

                <div class="setup-row">
                    <button class="btn" onclick="saveSettings()">âœ…</button>
                    <button class="btn btn-secondary" onclick="closeSettings()">âŒ</button>
                </div>
            </div>
        </div>
    </div>

    <div id="overlay">
        <!-- Success Modal -->
        <div class="modal" id="successModal">
            <div class="modal-content">
                <h2>ğŸ‰ğŸ‰ğŸ‰</h2>
                <div id="successModalDescription" class="success-details">
                    <p>ğŸ¯ï¼š<span id="successTarget"></span></p>
                    <p>â±ï¸ï¼š<span id="successTime"></span></p>
                    <p>ğŸ’¬ï¼š<span id="successMoves"></span></p>
                </div>
                <div class="share-area">
                    <button class="btn btn-settings" onclick="shareResult()">ğŸ“¤</button>
                    <div class="share-text" id="shareText"></div>
                </div>
                <div class="modal-buttons">
                    <button class="btn btn" onclick="resetGame()">ğŸ”</button>
                    <button class="btn btn-secondary" onclick="closeSuccessModal()">âŒ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="js-container"></div>

    <div id="toast">Some text some message..</div>

    <footer style="text-align: center; padding: 20px; color: white;">
        <p>â“ğŸ‘‰<a href="https://github.com/iceddog/ccb-puzzle/issues" style="color: white; text-decoration: none;">ğŸ</a>
        <p>â¤ï¸â¤ï¸â¤ï¸ <a href="https://space.bilibili.com/357428794" style="color: white; text-decoration: none;">ğŸ§ŠğŸ¶</a>
            â¤ï¸â¤ï¸â¤ï¸</p>
        <p>ï¼ˆæ­¤ç‰ˆæœ¬bugè¾ƒå¤šï¼Œä¸æä¾›æ”¯æŒï¼‰</p>
    </footer>

    <script src="../script.js"></script>
    <script> window.isEmoji = true; </script>
    <script>
        isChinese = function (char) {
            return /^\p{RGI_Emoji}$/v.test(char);
        }
        isPunctuation = function (char) {
            const punctuationRegex = /[ï¼Ÿ?ï¼!ã€ï¼šï¼›ï¼Œ,ã€‚.ï¼ˆï¼‰()ã€Šã€‹ã€ã€‘[\]_=+\-\*/]/;
            return punctuationRegex.test(char);
        }
        clearChatHistory = function () {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML = '<div class="chat-placeholder">ğŸˆ¶ï¸ğŸ’¬ğŸ“œ...</div>';
            gameState.chatHistory = [];
        }
        shareResult = function () {
            const moves = gameState.chatHistory.length / 2;
            const timeDiff = Math.floor((new Date() - gameState.startTime) / 1000);
            const minutes = Math.floor(timeDiff / 60);
            const seconds = timeDiff % 60;

            const modeText = gameState.hardMode ? 'ï¼ˆğŸ’€ï¼‰' : !gameState.disableEnglish ? 'ï¼ˆğŸš«ğŸ”¤ï¼‰' : '';

            let shareText = `æˆ‘åœ¨ğŸ’¬ğŸ§©ğŸ¯æ¸¸æˆä¸­æ‰¾åˆ°äº†"${gameState.targetWord}"ï¼ğŸ¥°
â°ğŸ¯ï¼š${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}${modeText}
ğŸ’¬ğŸ¤–ï¼š${moves}
ğŸ§ğŸ§±ï¼š${gameState.initBank}
ğŸ®ğŸ‘‰ ` + encodeURI(`https://puzzle.iceddog.top/emoji?target=${gameState.targetWord}&bank=${gameState.initBank}`);

            navigator.clipboard.writeText(shareText).then(() => {
                showToast('æ¸¸æˆè®°å½•å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', '#2ecc71');
            }).catch(err => {
                showToast('å¤åˆ¶å¤±è´¥: ' + err, '#e74c3c');
            });
        }
    </script>
</body>

</html>